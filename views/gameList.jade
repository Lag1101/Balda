extends layout/page
block content
    h1 Game list
    ul(id='gameList')

    script.
        var list = $('#gameList');
        var socket = io.connect('', {
            reconnect: true
        });

        var intervalId = null;
        socket
            .on('connect', function(){
                    console.log('connected');
                socket.emit(Events.gameList);
                intervalId = setInterval(function(){
                    socket.emit(Events.gameList);
                }, 500);
            })
            .on('disconnect', function(){
                    console.log('disconnected');
                clearInterval(intervalId);
                intervalId = null;
            })
            .on('error', function (err) {
                console.error(err);
            })
            .on(Events.gameList, function (newGameList) {
                list.empty();
                newGameList.keys.map(function(key){
                    var game = newGameList.elements[key];
                    var li = $('<li></li>').attr('href', '#');

                    $('<a></a>').text(game.players.keys[0]).appendTo(li);

                    li.appendTo(list);
                });
            });
